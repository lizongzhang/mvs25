---
title: "多重对应分析"
author: "Li Zongzhang"
date: today
output:
    highlight: github
    toc: yes
    number_sections: yes
editor_options:
  markdown:
    wrap: 72
execute:
  warning: false
  message: false
---




```{r message=FALSE, warning=FALSE, include=FALSE}
#MAC OS系统上图形中无法显示汉字，请运行第3-6行。
# 指定图形的中文字体
#install.packages("showtext")
library(showtext)
par(family  = 'STKaiti')
showtext_auto()
```

MCA 是对应分析（Correspondence Analysis, CA）在“多变量分类数据”上的推广，主要用于对多项（名义）分类变量集合进行降维和可视化。

目标：把高维的分类变量（每个变量有若干类别）映射到低维空间（通常 2 或 3 维），便于发现变量类别之间、样本（个体）之间以及变量与个体间的关联结构。


# MCA 示例：UCBAdmissions 数据集



```{r}
# UCBAdmissions 示例 —— 表示院系、性别与是否录取（含频数）
library(FactoMineR)
library(factoextra)

data(UCBAdmissions)
head(as.data.frame(UCBAdmissions))

# 展开频数表
df_tab2 <- as.data.frame(UCBAdmissions)    # Admit, Gender, Dept, Freq
df2 <- df_tab2[rep(1:nrow(df_tab2), df_tab2$Freq), 1:3]


# MCA 需要输入每一行为一个观测（个体），每列为一个分类变量（factor 或 character）
# 运行 MCA
res.mca <- MCA(df2, graph = FALSE)

# 特征值 / 惯性
print(res.mca$eig)

# 类别坐标与贡献
res.mca$var$coord
res.mca$var$contrib
```

<img src="img/mca.res1.png" style=width:800px; height:auto>

<img src="img/mca.res2.png" style=width:800px; height:auto>

<img src="img/mca.res3.png" style=width:800px; height:auto>

对应分析/通过多个维度捕捉数据中分类变量之间的结构。

特征值表示信息量，坐标表示类别在维度上的位置，贡献度表示哪些类别主导了维度的解释。

# 多重对应分析（MCA, Multiple Correspondence Analysis） 的类别散点图

```{r}
# 绘制各类别在第1维度和第2维度的位置
# 颜色代表类别的贡献
fviz_mca_var(res.mca, 
             repel = TRUE, 
             col.var = "contrib")
```


<img src="img/MCA.res4.png" style=width:800px; height:auto>

```{r}
# 绘制各类别在第3维度和第4维度的位置
fviz_mca_var(res.mca, 
             axes = c(3, 4),
             repel = TRUE, col.var = "contrib")
```

# 多重对应分析（MCA, Multiple Correspondence Analysis） 的个体散点图

```{r}
fviz_mca_ind(res.mca, 
             geom = "point", 
             habillage = interaction(df2$Gender, df2$Admit),  
             palette = RColorBrewer::brewer.pal(4, "Set3"),
             repel = TRUE)
```

Dim1 方向：

大体上，未录取个体（紫色、橙色）分布在右侧（Dim1 > 0），而录取个体（绿色、黄色）多在左侧（Dim1 < 0）。

说明 Dim1 可能与“录取结果”相关，是区分录取与未录取的主要维度。

Dim2 方向：

男性和女性在 Dim2 上有轻微分离：男性（绿色/紫色）偏下，女性（黄色/橙色）偏上。

说明 Dim2 可能与“性别”相关，但区分度没有 Dim1 明显。


```{r}
fviz_mca_ind(res.mca, 
             geom = "point", 
             habillage = interaction(df2$Gender, df2$Admit,
                                     df2$Dept),     
             palette = colorRampPalette(RColorBrewer::brewer.pal(9, "Blues"))(24), 
             repel = TRUE)
```

右上象限主要由 C、D、E 等系的组合组成，且以女性组居多，这些组沿第一维度倾向于和“被拒/系 C–E” 相关（图中在 Dim1 的正侧），在第二维度上也表现为正向（与 C 类系的特征一致）。

左上象限以“被录取（Admitted）”的组为主，尤其集中在系 A、B（以及部分在其他系的 admitted 男性），表明第一维度的负侧与“录取 / A、B 系”相关联。

左下象限主要包含男性组（集中在 A、B，以及一些 F 的 admitted），这些组在第二维度为负（受 Dept F 或男性模式影响），在第一维度又在负侧或接近负侧，呈现与 II 象限不同的男性/系别混合模式。

右下象限由系 F（以及部分 B/D/E）的组主导，Dim1 为正（接近“Rejected”侧），Dim2 为负（强烈受 Dept F 的负向特征影响），因此这一象限总体上表现出强烈的 F 系特征并包含较多被拒的组合。
